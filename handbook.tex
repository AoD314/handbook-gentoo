\documentclass[12pt, a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage[english, russian]{babel}
\usepackage[T2A]{fontenc}
\usepackage{xltxtra}
\usepackage{xecyr}

%\usepackage{polyglossia}  %% подключает пакет многоязыкой вёрстки
\setmainfont{Liberation Serif}  %% задаёт основной шрифт документа
\setsansfont{Liberation Sans}  %% задаёт шрифт без засечек
\setmonofont{Droid Sans Mono}  %% задаёт моноширинный шрифт
\defaultfontfeatures{Scale=MatchLowercase, Mapping=tex-text}  %% устанавливает поведение шрифтов по умолчанию
%\setdefaultlanguage[spelling=modern]{russian}  %% устанавливает язык по умолчанию
%\setotherlanguage{english}

\usepackage{cmap} % чтобы был поиск по pdf
\usepackage{ucs}
\usepackage{hyperref}

% меняем размеры страницы
\usepackage{geometry}
\geometry{left=2.0cm}
\geometry{right=2.0cm}
\geometry{top=2.0cm}
\geometry{bottom=2.5cm}

% переопределяем окружение verbatim
\makeatletter 
\renewcommand*\verbatim@font{% 
\normalfont\ttfamily\small 
\hyphenchar\font\m@ne 
\let\do\do@noligs \verbatim@nolig@list 
} 
\makeatother

\renewcommand{\thesection}{\arabic{section}.} 
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}.} 
\renewcommand{\thesubsubsection}{\arabic{section}.\arabic{subsection}.\arabic{subsubsection}.} 

\begin{document}

\begin{titlepage}
\begin{center}
\vspace*{10cm}
{ \rm \Huge \textbf
	{
		\fontspec{Ubuntu}{print(gentoo.calculate\_linux)}
	}
}
\vfill 
{ \rm \large  \fontspec{Ubuntu}{2011}  }
\end{center}
\end{titlepage}

\tableofcontents

\newpage

\section{Введение}

Данный документ распространяется под лицензией CC-BY\footnote{Creative Commons - \href{http://creativecommons.org/licenses/by/3.0/legalcode}{http://creativecommons.org/licenses/by/3.0/legalcode}}.

\subsection{Gentoo}

Gentoo Linux (произносится: дженту, сленг - генту, гента) - достаточно популярный дистрибутив Linux с мощной и гибкой технологией Portage, которая совмещает в себе возможности конфигурирования, настройки, а также автоматизированную систему управления пакетами. Последняя создавалась под влиянием системы управления пакетами в FreeBSD. Отличительной особенностью Gentoo является наличие оптимизации под конкретное аппаратное обеспечение.

Дистрибутив ведёт своё начало с разработки Дэниелом Роббинсом (англ.) дистрибутива Enoch Linux в 1999 году. Благодаря системе Portage, позволяющей сделать из Gentoo практически всё, что угодно (от сервера до рабочей станции), этот дистрибутив можно отнести к так называемым мета-дистрибутивам.

Gentoo (по-русски читается генту, название вида пингвинов укрепилось в русском языке задолго до появления дистрибутива) - это английское название вида пингвинов Pygoscelis papua. Согласно Книге рекордов Гиннеса 98, этому виду пингвинов принадлежит рекорд скорости плавания (36 км/ч).

Gentoo появился на основе разработок собственного дистрибутива Даниэла Роббинса под названием Enoch Linux. Основной целью дистрибутива являлась собственная сборка (подобная Linux From Scratch), оптимизированная под конкретное аппаратное обеспечение и содержащее минимальный, необходимый пользователю, набор программ.



Эксперименты над сборками GCC показали, что производительность получаемого пакета увеличивалась (в зависимости от аппаратного обеспечения) от 10 до 200 \% по сравнению с бинарными сборками gcc, поставляемыми другими дистрибутивами. Наработки, увеличивающие производительность, были включены в официальный выпуск GCC 2.95, благодаря чему другие дистрибутивы также получили дополнительный прирост в производительности. Начиная с этого момента, Enoch начал приобретать репутацию быстрого дистрибутива, после чего было принято решение сменить название на Gentoo Linux.

31 марта 2002 года вышла первая версия дистрибутива. В 2004 году была основана некоммерческая организация Gentoo Foundation, в ведение которой Роббинс передал все права на исходный код и торговые марки, тем самым отстранившись от разработки дистрибутива. На данный момент разработка управляется группой Board of Trustees из пяти человек (ответственных за управление фондом) и советом Gentoo Council (технические вопросы), состоящим из семи членов, выбираемых на срок в один год. В начале 2009 года обновился дизайн сайта. На главной странице отображаются новости, обсуждения и статьи разработчиков, а также извещения о критических уязвимостях (Gentoo Linux Security Advisory). В октябре 2009 года Gentoo исполнилось десять лет, в связи с чем подготовлена большая коллекция скриншотов и хронология дистрибутива.

Философия Gentoo проистекает от дней основания дистрибутива и остаётся в неизменном виде и по сей день. Вот как вкратце излагает концепцию проекта его основатель Дэниэл Роббинс:

\begin{center}
\begin{tabular}{p{14cm}}
Каждому пользователю приходится выполнять определённую работу. Цель Gentoo — разработка инструментов и систем, позволяющих пользователю заниматься своим делом как можно эффективнее и в своё удовольствие, так, как он сочтет нужным. Наши инструменты должны приносить радость и помогать пользователю оценить по достоинству все богатство Linux и сообщества свободного программного обеспечения, а также гибкость свободных программ. Такое возможно только тогда, когда инструменты создаются, чтобы отражать и проводить волю пользователя, оставляя для него открытыми все возможности с самого начала (с исходного кода). Когда инструмент заставляет пользователя действовать определённым образом, инструмент работает против него, а не на него. Все мы сталкивались с ситуациями, когда инструменты стремились навязать нам свою собственную волю. Такой подход — полная противоположность, несовместимая с философией Gentoo.
Иными словами, философия Gentoo — создание лучших инструментов. Когда инструмент в совершенстве выполняет свою задачу, вы можете даже не замечать его присутствия, потому что он не перечит вам, не проявляет себя, и не заставляет вас возиться с ним, когда вам совершенно не до этого. Инструмент служит пользователю, а не пользователь — инструменту.
Будущая задача Gentoo — продолжать борьбу за создание инструментов, близких к идеалу. Инструментов, удовлетворяющих нужды множества различных пользователей (каждого — со своими разнообразными целями) с простотой, идущей рука об руку с непревзойдённой мощью. Разве вы не любите пользоваться инструментами, которые отлично подходят для ваших нужд? Разве это не великолепное ощущение? Наша цель — передать это чувство как можно большему числу людей.
\newline
\begin{flushright}
— Дэниел Роббинс
\end{flushright}

\end{tabular}
\end{center}

\subsection{Calculate Linux}

\newpage

\section{Установка. Обновление. Профили}

\subsection{Системные требования}
\subsection{Gentoo}

\subsubsection{Gentoo. Установка}

Для установки необходимо скачать установочный диск с минимальным набором программ: 
install-amd64-minimal-[...].iso
(\href{http://mirror.yandex.ru/gentoo-distfiles/releases/amd64/current-iso/install-amd64-minimal-20110811.iso}{install-amd64-minimal-20110811.iso})

После того, как установили настройки в биосе, о том что необходимо произвести загрузку с cdrom, грузимся. После загрузки нам предлагают выбрать какое ядро грузить, пишем gentoo. Далее идет процесс загрузки ядра и в результате получаем консоль с правами доступа root.


{\bf Подготавиваем HDD}

Для установки потребуется жесткий диск размером не менее 6,5 гб. Разбить диск необходимо следующим образом:

\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline точка монтирования  & размер & файловая система & раздел диска \\
\hline swap  & 2 * RAM & swap & /dev/sda1 \\
\hline /boot & 200 Mb & ext2  & /dev/sda2 \\
\hline / & минимум 6 Гб & ext4 & /dev/sda3 \\
\hline
\end{tabular}
\end{center}

Что бы произвести разметку диска, необходимо воспользоваться программой fdisk:

\begin{verbatim}
# fdisk /dev/sda
\end{verbatim}

% TODO: написать о том как пользоваться программой fdisk

После того как разделы были созданы, необходимо их отформатировать, с указанием файловой системы:

\begin{verbatim}
# mkfs.ext2 /dev/sda2
# mkfs.ext4 /dev/sda4
\end{verbatim}

Создадим swap и запустим его:

\begin{verbatim}
# mkswap /dev/sda1
# swapon /dev/sda1
\end{verbatim}

{\bf Устанавливаем разделы}

\begin{verbatim}
# mount /dev/sda3 /mnt/gentoo
# mkdir /mnt/gentoo/boot
# mount /dev/sda2 /mnt/gentoo/boot
\end{verbatim}

Далее необходимо скачать последние пакеты (stage3-i686-xxx.tar.bz2, portage-latest.tar.bz2)

{\bf Настройка сети}

откроем для редактирования след. файл:

\begin{verbatim}
# vim /etc/conf.d/net
\end{verbatim}

допишем настройки:

\begin{verbatim}
# config_eth0=("192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255")
## config_eth0=("dhcp")
# routes_eth0=("default via 192.168.0.1")
\end{verbatim}

добавим настройку сети в загрузку:

\begin{verbatim}
# rc-update add net.eth0 default
* net.eth0 added to runlevel default
# cd /etc/init.d/
# ln -s net.lo net.eth1
# rc-update add net.eth1 default
* net.eth1 added to runlevel default
\end{verbatim}

Скачиваем пакеты. 
В случае, если нету интернета, а установить приложение очень хочется, то можно скачать пакет руками на другой машине и положить архив в каталог:
\begin{verbatim}
/usr/portage/distfiles
\end{verbatim}

Распаковываем:

\begin{verbatim}
# cd /mnt/gentoo
# tar xvjpf /mnt/gentoo/tmp/stage3-*.tar.bz2
\end{verbatim}

Затем:

\begin{verbatim}
# cd /mnt/gentoo
# tar xvjf /mnt/gentoo/tmp/portage-latest.tar.bz2 -C /mnt/gentoo/usr
\end{verbatim}

Отредактируем файл:

\begin{verbatim}
# vim /mnt/gentoo/etc/make.conf
\end{verbatim}

исправив строчку с параметрами компиляции на:

\begin{verbatim}
LINGUAS="en ru"
ACCEPT_LICENSE="*"

USE="sse sse2 sse3 ssse3 sse4.1 sse4.2 qt4"

CFLAGS="-march=corei7  -mtune=corei7  -O2 -pipe -msse4.1 -msse4.2 -mpopcnt -fomit-frame-pointer"
#CFLAGS="-march=core2  -mtune=generic -fomit-frame-pointer"

MAKEOPTS="-j5 -s"

EMERGE_DEFAULT_OPTS="--jobs=2"
\end{verbatim}


{\bf Вход в новую систему}


Выбираем зеркало.

\begin{verbatim}
# mirrorselect -i -r -o >> /mnt/gentoo/etc/make.conf
\end{verbatim}

затем копируем dns:

\begin{verbatim}
# cp -L /etc/resolv.conf /mnt/gentoo/etc
\end{verbatim}

монтируем /proc и /dev:

\begin{verbatim}
# mount -t proc none /mnt/gentoo/proc
# mount -o bind /dev /mnt/gentoo/dev
\end{verbatim}

переносим оставшиеся настройки:

\begin{verbatim}
# chroot /mnt/gentoo /bin/bash
# env-update
>> Regenerating /etc/ld.so.cache...
# source /etc/profile
# export PS1="(chroot) $PS1"
\end{verbatim}

{\bf Конфигурируем Portage}

\begin{verbatim}
# emerge --sync --quiet
\end{verbatim}

Укажем в переменную USE программы, которые мы хотим тоже скомпилировать. список всех программ доступен для просмотра так:

\begin{verbatim}
# less /usr/portage/profiles/use.desc
\end{verbatim}

откроем для редактированич файл /etc/make.conf и уточним переменную USE:

\begin{verbatim}
# vim /etc/make.conf

USE="sse sse2 sse3 ssse3 sse4.1 sse4.2 qt4 gmp posix threads x264"
\end{verbatim}

Осталось только локализовать:

\begin{verbatim}
# vim /etc/locale.gen
\end{verbatim}

в файл /etc/locale.gen записываем:

\begin{verbatim}
en_US ISO-8859-1
en_US.UTF-8 UTF-8
ru_RU.UTF-8 UTF-8
ru_RU.KOI8-R KOI8-R
ru_RU.ISO-8859-5 ISO-8859-5
ru_RU.CP1251 CP1251
\end{verbatim}

запускаем генерацию:

\begin{verbatim}
# locale-gen
\end{verbatim}

{\bf Конфигурируем ядро.}

определим время:

\begin{verbatim}
# cp /usr/share/zoneinfo/Etc/GMT+3 /etc/localtime
\end{verbatim}

Выбираем ядро и установим с помощью emerge:

\begin{verbatim}
# emerge gentoo-sources
\end{verbatim}

конфигурируем ядро:

\begin{verbatim}
# cd /usr/src/linux
# make menuconfig
\end{verbatim}

После компилируем:

\begin{verbatim}
# make && make modules_install
\end{verbatim}

затем копируем в загрузочный раздел получившиеся ядро:

\begin{verbatim}
# cp arch/x86_64/boot/bzImage /boot/kernel-3.0.3-gentoo
\end{verbatim}

{\bf Конфигурирование системы}

в файле /etc/fstab  содержится информация о том, какие разделы и где находятся и параметры их монтирования. Этот файл нужно отредактировать.

/etc/fstab использует специальный синтаксис. Каждая строка - это запись, состоящ. из 6 полей, разделенные табом или пробелами:
\begin{itemize}
\item partition - путь к файлу устройства
\item mount point - указывает точку монтирования, в которую должен быть установлен раздел
\item filesystem - файловая система, которую использует раздел
\item mount options - опции монтирования, разделенные запятыми(подробнее в man)
\item dump - используется дампом для определения сбрасывания или нет(Нужно ставить 0)
\item fsck - используется для определения и проверки файловой системы, если она была выключена не должным образом. Коневая файловая система должна имет 1, в то время как остальные должны иметь 2 (или 0, если проверка файловой системы не нужна).
\end{itemize}

Переходим непосредственно к редактированию:

\begin{verbatim}
# vim /etc/fstab
\end{verbatim}

должно получится что то такое:
\newline

\begin{tabular}{llllcc}
/dev/sda1 & none & swap & sw & 0 & 0 \\
/dev/sda2 & /boot & ext2 & defaults, noatime & 0 & 2\\
/dev/sda3 & / & ext4 & defaults, noatime & 0 & 1 \\
/dev/cdrom& /mnt/cdrom & auto & noauto,user,ro,utf8 & 0 & 0 \\
proc & /proc & proc & nosuid,noexec,gid=proc & 0 & 0 \\
\end{tabular}




{\bf Настройка входа в систему}

сменим пароль рута:

\begin{verbatim}
# passwd
\end{verbatim}

Установим вход в систему:

\begin{verbatim}
# emerge syslog-ng
# rc-update add syslog-ng default

# emerge vixie-cron
# rc-update add vixie-cron default
# crontab /etc/crontab

## for indexing your files
# emerge mlocate

# emerge dhcpcd

# emerge ppp vim links ...
\end{verbatim}


{\bf Конфигурируем загрузчик}

Теперь, когда наше ядро сконфигурировано и откомпилировано, и необходимые системные файлы конфигурации заполнены правильно, пришло время установить программу, которая запустит наше ядро.

Установим GRUB:

\begin{verbatim}
# emerge grub
# vim /boot/grub/grub.conf
\end{verbatim}

Отредактируем файл, и получим приблизительно след.:

\begin{verbatim}
default 0
timeout 10
splashimage=(hd0,1)/boot/grub/splash.xpm.gz

title Gentoo Linux 3.0.3
root (hd0,1)
kernel /boot/kernel-3.0.3-gentoo root=/dev/sda1 rootfstype=ext4

title windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
\end{verbatim}

установим grub:

\begin{verbatim}
# grep -v rootfs /proc/mounts > etc/mtab
# grub-install --no-floppy /dev/sda
\end{verbatim}

Теперь все ! ребутяемся.

\begin{verbatim}
# exit 
cdimage~# cd 
cdimage~# umount /mnt/gentoo/boot /mnt/gentoo/dev /mnt/gentoo/proc /mnt/gentoo
cdimage~# reboot

\end{verbatim}

После загрузки можно поставить eix, layman.
Искать можно так:
\begin{verbatim}
# emerge --search eix
\end{verbatim}

Заходить из под рута плохо, поэтому создадим пользователя:
\begin{verbatim}
# useradd -m -G audio,cdrom,portage,usb,users,video,wheel -s /bin/bash user
# passwd user
\end{verbatim}


\subsubsection{Gentoo. Обновление}

\begin{verbatim}
# emerge --update --deep --newuse world
# emerge --depclean
# revdep-rebuild
\end{verbatim}

Установим и настроим eix:
\begin{verbatim}
# emerge eix
# eix-update
\end{verbatim}

Установим layman:
\begin{verbatim}
# emerge layman
\end{verbatim}

Обновим gcc:
\begin{verbatim}
# emerge -av gcc
\end{verbatim}

Пересборка мира:
\begin{verbatim}
emerge -aveNUD @system @world
\end{verbatim}

\subsection{Calculate Linux}

\subsubsection{Calculate Linux. Установка}
\subsubsection{Calculate Linux. Обновление}

\subsection{Управление профилями пользователей}

\newpage 

\section{Работа с командной строкой}

\subsection{Поиск файлов}

\newpage

\section{Менеджер пакетов}

\subsection{утилита rc-update}

\subsection{создание RAID}

\subsection{Установка и удаление программ}

Установить пакет в бинарном виде:

\begin{verbatim}
# emerge -avg media-video/vcdimager
\end{verbatim}

\subsection{Разрешение зависимостей}

\begin{verbatim}
# equery d sys-auth/thinkfinger
\end{verbatim}

\subsection{Поиск зависимостей}

\subsection{Написание собственных ebuild файлов}

\newpage
\section{Настройка}

\subsection{Настройка сети}

\subsection{Настройка авто запуска}

%\subsection{}
%\subsection{}
%\subsection{}
%\subsection{}
%\subsection{}
%\subsection{}
%\subsection{}

\subsection{Персональные настройки}

\subsubsection{Настройка /etc/inputrc}

Необходимо дописать для удобного поиска:

\begin{verbatim}
"\e[A":history-search-backward
"\e[B":history-search-forward
\end{verbatim}


\subsubsection{Настройка bash}
\begin{verbatim}
PS1='\[\e[1;32m\]\u \[\e[0;31m\][\[\e[1;34m\]
\w\[\e[0;31m\]] \[\e[1;37m\]{\t}\n\$ '

PATH=$PATH:/opt/cuda/bin
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/cuda/lib64

alias l="ls -lah"

shopt -s histappend
PROMPT_COMMAND='history -a'
shopt -s cdspell
\end{verbatim}

\subsubsection{Настройка vim}
\begin{verbatim}
set nu 
set ts=4
set vb " Заменять звуковой сигнал визуальным

colorscheme Black
set background=dark
set listchars=tab:..
set list

if (has('gui'))
····set gfn=Droid\ Sans\ Mono\ 10 
····set lines=50
····set columns=101
endif

set history=8000
set showcmd

if has("autocmd")
····filetype indent on 
endif

set incsearch
set nohlsearch

" OmniComplete
map <C-F12> <Esc>:!ctags -R --c++-kinds=+p --fields=+iaS --extra=+q ..<CR>
let OmniCpp_GlobalScopeSearch = 1
let OmniCpp_NamespaceSearch = 1
filetype plugin on 
filetype indent on 
set ofu=syntaxcomplete#Complete


map <F2> <Esc>:tabprev <Esc>
map <F3> <Esc>:tabnext <Esc>
map <F4> <Esc>:tab sp .<CR>

" вставка текста без комментариев
set fo-=ro

" Настройка свертки
set foldenable
set foldlevel=25

set t_Co=256
\end{verbatim}


\subsubsection{Настройка mplayer}
\begin{verbatim}
# Write your default config options here!
#font=~/.mplayer/FreeSans.ttf
fontconfig = true
font = "Droid Sans Mono"
double=yes
#cache=65536
subfont-text-scale = 3
subfont-blur = 1
subfont-osd-scale = 1
subfont-outline = 1
nolirc=yes
lavdopts=threads=8
af=volnorm
\end{verbatim}

\newpage
\section{Мониторинг и производительность}

\subsection{Мониторинг}

\subsection{Оптимизация eix}

\subsection{SSD}

\subsection{Распределенная компиляция}

\newpage

\section{Приложение}

%\subsection{}

\newpage
\begin{thebibliography}{99}
\addcontentsline{toc}{section}{Список литературы}

	\bibitem{wiki_gentoo} http://ru.wikipedia.org/wiki/Gentoo
	
	

\end{thebibliography}

\end{document}

